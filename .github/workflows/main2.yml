name: Build and Push with AccessKey

on:
  push:
    branches: [ main ]

env:
  # 你的个人版实例地址
  ACR_INSTANCE: crpi-30m5pxt0p5qxy6sk.cn-hangzhou.personal.cr.aliyuncs.com
  # 你的命名空间
  ACR_NAMESPACE: yunzyuns  # 改成你的命名空间

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    # 方法1：直接使用 AccessKey 登录（RAM用户）
    - name: Login to ACR with AccessKey
      run: |
        # RAM用户使用AccessKey登录
        echo "${{ secrets.ALIYUN_ACCESS_KEY_SECRET }}" | docker login \
          --username "${{ secrets.ALIYUN_ACCESS_KEY_ID }}" \
          --password-stdin \
          ${{ env.ACR_INSTANCE }}
    
    - name: Build and Push
      run: |
        # 构建
        docker build -t ${{ env.ACR_INSTANCE }}/${{ env.ACR_NAMESPACE }}/paddleocr-gpu:latest .
        
        # 推送
        docker push ${{ env.ACR_INSTANCE }}/${{ env.ACR_NAMESPACE }}/paddleocr-gpu:latest
        
        echo "✅ 推送成功！"
